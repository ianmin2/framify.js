"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};angular.module("framify.js",["ui.router","framify-paginate","ngStorage","jsonFormatter","chart.js","ngAria","ngMaterial","ngMessages"]).service("app",["$http","remoteAuth",function(e,a){var n=this,t=window.location.href.split("/").filter(function(e){return""!=e&&"http:"!=e&&"https:"!=e}),o=window.location.href.split("/").filter(function(e){return""!=e});this.scheme=o[0],this.ip=t[0].split(":")[0],this.port=t[0].split(":")[1],this.hlink=this.scheme+"//"+this.ip+(void 0!=this.port?":"+this.port:""),this.url=this.hlink;var r=this.hlink;this.nav=[],this.redirect=function(e){return e?window.location=e:window.location="/",Promise.resolve(!0).catch(function(e){console.log("Encountered an error when processing the redirect function."),console.dir(e)})},this.setVar=function(e,a,n){return e=e?e:{},e[a]=n,e},this.str=function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))?JSON.stringify(e):e},this.stringify=function(e){return Promise.resolve(n.str(e))},this.json=function(e){return"object"===("undefined"==typeof e?"undefined":_typeof(e))?e:JSON.parse(e)},this.jsonify=function(e){return Promise.resolve(n.json(e))},this.md5=function(e){return/^[a-f0-9]{32}$/gm.test(e)?e:CryptoJS.MD5(e).toString()},this.md5ify=function(e){return Promise.resolve(n.md5(e))},this.base64_encode=function(e){return CryptoJS.enc.Base64.stringify(CryptoJS.enc.Utf8.parse(e))},this.base64_encodify=function(e){return Promise.resolve(n.base64_encode(e))},this.base64_decode=function(e){return CryptoJS.enc.Base64.parse(e).toString(CryptoJS.enc.Utf8)},this.base64_decodify=function(e){return Promise.resolve(n.base64_decode(e))},this.upload=function(a,n){return new Promise(function(t,o){var i=new FormData;for(var s in a)i.append(s,a[s]);e.post(r+"/upload/"+n,i,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(e){return t(e)})})},this.keys=function(e){return Object.keys(e)},this.vals=function(e){var a=[];return Object.keys(e).forEach(function(n){a.push(e[n])}),a},this.clone=function(e){if(null==e||"object"!=("undefined"==typeof e?"undefined":_typeof(e)))return e;var a=e.constructor();for(var n in e)e.hasOwnProperty(n)&&(a[n]=/^[0-9]+$/.test(e[n])?parseInt(e[n]):e[n]);return a},this.parseInt=function(e){return parseInt(e)},this.doNothing=function(){return Promise.resolve().catch(function(e){console.log("Encountered an error when processing the donothing function."),console.dir(e)})},this.getNumbers=function(e){var a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=/\d+/g;return a?e.toString().match(n)[0]:e.toString().match(n)},this.notify=function(e,a,n,t){return UIkit.notify({message:"<center>"+(e||"A blank notification was triggered.")+"</center>",status:a||"info",timeout:n||6e3,pos:"top-center"}),Promise.resolve(!0).catch(function(e){console.dir(e)})};this.notify;this.countries=[{name:"Afghanistan",value:"1"},{name:"Albania",value:"2"},{name:"Algeria",value:"3"},{name:"American Samoa",value:"4"},{name:"Andorra",value:"5"},{name:"Angola",value:"6"},{name:"Anguilla",value:"7"},{name:"Antarctica",value:"8"},{name:"Antigua and Barbuda",value:"9"},{name:"Argentina",value:"10"},{name:"Armenia",value:"11"},{name:"Aruba",value:"12"},{name:"Australia",value:"13"},{name:"Austria",value:"14"},{name:"Azerbaijan",value:"15"},{name:"Bahamas",value:"16"},{name:"Bahrain",value:"17"},{name:"Bangladesh",value:"18"},{name:"Barbados",value:"19"},{name:"Belarus",value:"20"},{name:"Belgium",value:"21"},{name:"Belize",value:"22"},{name:"Benin",value:"23"},{name:"Bermuda",value:"24"},{name:"Bhutan",value:"25"},{name:"Bolivia",value:"26"},{name:"Bosnia and Herzegowina",value:"27"},{name:"Botswana",value:"28"},{name:"Bouvet Island",value:"29"},{name:"Brazil",value:"30"},{name:"British Indian Ocean Territory",value:"31"},{name:"Brunei Darussalam",value:"32"},{name:"Bulgaria",value:"33"},{name:"Burkina Faso",value:"34"},{name:"Burundi",value:"35"},{name:"Cambodia",value:"36"},{name:"Cameroon",value:"37"},{name:"Canada",value:"38"},{name:"Cape Verde",value:"39"},{name:"Cayman Islands",value:"40"},{name:"Central African Republic",value:"41"},{name:"Chad",value:"42"},{name:"Chile",value:"43"},{name:"China",value:"44"},{name:"Christmas Island",value:"45"},{name:"Cocos (Keeling) Islands",value:"46"},{name:"Colombia",value:"47"},{name:"Comoros",value:"48"},{name:"Congo",value:"49"},{name:"Congo, the Democratic Republic of the",value:"50"},{name:"Cook Islands",value:"51"},{name:"Costa Rica",value:"52"},{name:"Cote d'Ivoire",value:"53"},{name:"Croatia (Hrvatska)",value:"54"},{name:"Cuba",value:"55"},{name:"Cyprus",value:"56"},{name:"Czech Republic",value:"57"},{name:"Denmark",value:"58"},{name:"Djibouti",value:"59"},{name:"Dominica",value:"60"},{name:"Dominican Republic",value:"61"},{name:"East Timor",value:"62"},{name:"Ecuador",value:"63"},{name:"Egypt",value:"64"},{name:"El Salvador",value:"65"},{name:"Equatorial Guinea",value:"66"},{name:"Eritrea",value:"67"},{name:"Estonia",value:"68"},{name:"Ethiopia",value:"69"},{name:"Falkland Islands (Malvinas)",value:"70"},{name:"Faroe Islands",value:"71"},{name:"Fiji",value:"72"},{name:"Finland",value:"73"},{name:"France",value:"74"},{name:"France Metropolitan",value:"75"},{name:"French Guiana",value:"76"},{name:"French Polynesia",value:"77"},{name:"French Southern Territories",value:"78"},{name:"Gabon",value:"79"},{name:"Gambia",value:"80"},{name:"Georgia",value:"81"},{name:"Germany",value:"82"},{name:"Ghana",value:"83"},{name:"Gibraltar",value:"84"},{name:"Greece",value:"85"},{name:"Greenland",value:"86"},{name:"Grenada",value:"87"},{name:"Guadeloupe",value:"88"},{name:"Guam",value:"89"},{name:"Guatemala",value:"90"},{name:"Guinea",value:"91"},{name:"Guinea-Bissau",value:"92"},{name:"Guyana",value:"93"},{name:"Haiti",value:"94"},{name:"Heard and Mc Donald Islands",value:"95"},{name:"Holy See (Vatican City State)",value:"96"},{name:"Honduras",value:"97"},{name:"Hong Kong",value:"98"},{name:"Hungary",value:"99"},{name:"Iceland",value:"100"},{name:"India",value:"101"},{name:"Indonesia",value:"102"},{name:"Iran (Islamic Republic of)",value:"103"},{name:"Iraq",value:"104"},{name:"Ireland",value:"105"},{name:"Israel",value:"106"},{name:"Italy",value:"107"},{name:"Jamaica",value:"108"},{name:"Japan",value:"109"},{name:"Jordan",value:"110"},{name:"Kazakhstan",value:"111"},{name:"Kenya",value:"112"},{name:"Kiribati",value:"113"},{name:"Korea, Democratic People's Republic of",value:"114"},{name:"Korea, Republic of",value:"115"},{name:"Kuwait",value:"116"},{name:"Kyrgyzstan",value:"117"},{name:"Lao, People's Democratic Republic",value:"118"},{name:"Latvia",value:"119"},{name:"Lebanon",value:"120"},{name:"Lesotho",value:"121"},{name:"Liberia",value:"122"},{name:"Libyan Arab Jamahiriya",value:"123"},{name:"Liechtenstein",value:"124"},{name:"Lithuania",value:"125"},{name:"Luxembourg",value:"126"},{name:"Macau",value:"127"},{name:"Macedonia, The Former Yugoslav Republic of",value:"128"},{name:"Madagascar",value:"129"},{name:"Malawi",value:"130"},{name:"Malaysia",value:"131"},{name:"Maldives",value:"132"},{name:"Mali",value:"133"},{name:"Malta",value:"134"},{name:"Marshall Islands",value:"135"},{name:"Martinique",value:"136"},{name:"Mauritania",value:"137"},{name:"Mauritius",value:"138"},{name:"Mayotte",value:"139"},{name:"Mexico",value:"140"},{name:"Micronesia, Federated States of",value:"141"},{name:"Moldova, Republic of",value:"142"},{name:"Monaco",value:"143"},{name:"Mongolia",value:"144"},{name:"Montserrat",value:"145"},{name:"Morocco",value:"146"},{name:"Mozambique",value:"147"},{name:"Myanmar",value:"148"},{name:"Namibia",value:"149"},{name:"Nauru",value:"150"},{name:"Nepal",value:"151"},{name:"Netherlands",value:"152"},{name:"Netherlands Antilles",value:"153"},{name:"New Caledonia",value:"154"},{name:"New Zealand",value:"155"},{name:"Nicaragua",value:"156"},{name:"Niger",value:"157"},{name:"Nigeria",value:"158"},{name:"Niue",value:"159"},{name:"Norfolk Island",value:"160"},{name:"Northern Mariana Islands",value:"161"},{name:"Norway",value:"162"},{name:"Oman",value:"163"},{name:"Pakistan",value:"164"},{name:"Palau",value:"165"},{name:"Panama",value:"166"},{name:"Papua New Guinea",value:"167"},{name:"Paraguay",value:"168"},{name:"Peru",value:"169"},{name:"Philippines",value:"170"},{name:"Pitcairn",value:"171"},{name:"Poland",value:"172"},{name:"Portugal",value:"173"},{name:"Puerto Rico",value:"174"},{name:"Qatar",value:"175"},{name:"Reunion",value:"176"},{name:"Romania",value:"177"},{name:"Russian Federation",value:"178"},{name:"Rwanda",value:"179"},{name:"Saint Kitts and Nevis",value:"180"},{name:"Saint Lucia",value:"181"},{name:"Saint Vincent and the Grenadines",value:"182"},{name:"Samoa",value:"183"},{name:"San Marino",value:"184"},{name:"Sao Tome and Principe",value:"185"},{name:"Saudi Arabia",value:"186"},{name:"Senegal",value:"187"},{name:"Seychelles",value:"188"},{name:"Sierra Leone",value:"189"},{name:"Singapore",value:"190"},{name:"Slovakia (Slovak Republic)",value:"191"},{name:"Slovenia",value:"192"},{name:"Solomon Islands",value:"193"},{name:"Somalia",value:"194"},{name:"South Africa",value:"195"},{name:"South Georgia and the South Sandwich Islands",value:"196"},{name:"South Sudan",value:"197"},{name:"Spain",value:"198"},{name:"Sri Lanka",value:"199"},{name:"St. Helena",value:"200"},{name:"St. Pierre and Miquelon",value:"201"},{name:"Sudan",value:"202"},{name:"Suriname",value:"203"},{name:"Svalbard and Jan Mayen Islands",value:"204"},{name:"Swaziland",value:"205"},{name:"Sweden",value:"206"},{name:"Switzerland",value:"207"},{name:"Syrian Arab Republic",value:"208"},{name:"Taiwan, Province of China",value:"209"},{name:"Tajikistan",value:"210"},{name:"Tanzania, United Republic of",value:"211"},{name:"Thailand",value:"212"},{name:"Togo",value:"213"},{name:"Tokelau",value:"214"},{name:"Tonga",value:"215"},{name:"Trinidad and Tobago",value:"216"},{name:"Tunisia",value:"217"},{name:"Turkey",value:"218"},{name:"Turkmenistan",value:"219"},{name:"Turks and Caicos Islands",value:"220"},{name:"Tuvalu",value:"221"},{name:"Uganda",value:"222"},{name:"Ukraine",value:"223"},{name:"United Arab Emirates",value:"224"},{name:"United Kingdom",value:"225"},{name:"United States",value:"226"},{name:"United States Minor Outlying Islands",value:"227"},{name:"Uruguay",value:"228"},{name:"Uzbekistan",value:"229"},{name:"Vanuatu",value:"230"},{name:"Venezuela",value:"231"},{name:"Vietnam",value:"232"},{name:"Virgin Islands (British)",value:"233"},{name:"Virgin Islands (U.S.)",value:"234"},{name:"Wallis and Futuna Islands",value:"235"},{name:"Western Sahara",value:"236"},{name:"Yemen",value:"237"},{name:"Yugoslavia",value:"238"},{name:"Zambia",value:"239"},{name:"Zimbabwe",value:"240"}],this.makeResponse=function(e,a,n){return{response:e,data:{message:a,command:n}}},this.make_response=this.makeResponse,this.date=function(){return new Date},this.newDate=function(){return(new Date).toDateString()},this.new_date=this.newDate,this.isoDate=function(){return(new Date).format("isoDate")},this.iso_date=this.isoDate,this.getIsoDate=function(e){return new Date(e).format("isoDate")},this.get_iso_date=this.getIsoDate,this.toIsoDate=function(e){return e.format("isoDate")},this.to_iso_date=this.toIsoDate,this.dateTime=function(){return(new Date).format("dateTime")},this.date_time=this.dateTime,this.getDateTime=function(e){return new Date(e).format("dateTime")},this.get_date_time=this.getDateTime,this.toDateTime=function(e){return e.format("dateTime")},this.to_date_time=this.toDateTime,this.monthNum=function(){return(new Date).format("monthNum")},this.month_num=this.monthNum,this.getMonthNum=function(e){return new Date(e).format("monthNum")},this.get_month_num=this.getMonthNum,this.toMonthNum=function(e){return e.format("monthNum")},this.to_month_num=this.toMonthNum;var i=["January","February","March","April","May","June","July","August","September","October","November","December"];this.month_array=i,this.month_o_array=[{id:0,name:"January"},{id:1,name:"February"},{id:2,name:"March"},{id:3,name:"April"},{id:4,name:"May"},{id:5,name:"June"},{id:6,name:"July"},{id:7,name:"August"},{id:8,name:"September"},{id:9,name:"October"},{id:10,name:"November"},{id:11,name:"December"}],this.ajax=function(e,a,n){return $.ajax({method:e||"POST",url:a,data:n,dataType:"jsonp",headers:{"Access-Control-Allow-Origin":"*"}})},this.getJSON=function(e){return $.getJSON(e.replace(/callback=?/gi,"")+"?callback=?")},this.get_json=this.getJSON,this.cgi=function(e,a,n){return $.ajax({method:e||"GET",url:a,data:n,dataType:"jsonp",headers:{"Access-Control-Allow-Origin":"*"}})},this.loadify=function(e,a){return new Promise(function(n,t){var o=UIkit.modal.blockUI('<center><i style="color:blue;" class="fa fa fa-spinner fa-pulse fa-5x fa-fw"></i></center>'+(a?"<center><br>"+a+"</center>":""));e&&!isNaN(e)?setTimeout(function(){o.hide(),n(!0)},e):n(o)})},this.alert=function(e,a,n){return UIkit.modal.alert('<font color="#1976D2" style="font-weight:bold;text-transform:uppercase;">'+(e||"Notice")+"</font>\n            <hr>\n            <center>"+(a||"</center><font color=red font-weight=bold; font-size=2em>Oops!</font><br>False alarm!<center>")+"</center>"),n&&"function"==typeof n?Promise.resolve(n(a)).catch(function(e){console.log("Encountered an error when processing the alert function."),console.dir(e)}):Promise.resolve(!0).catch(function(e){console.log("Encountered an error when processing the alert2 function."),console.dir(e)})},this.confirm=function(e,a,n){return new Promise(function(t){UIkit.modal.confirm('<font color="#1976D2" style="font-weight:bold;text-transform:uppercase;">'+(e||"Confirmation required.")+"</font>\n                <hr>\n                <center>"+a+"</center>",function(){t(n&&"function"==typeof n?n(a):!0)})})},this.prompt=function(e,a,n,t){return new Promise(function(o){UIkit.modal.prompt('<font color="#1976D2" style="font-weight:bold;text-transform:uppercase;">'+(e||"Info required")+"</font>\n            <hr>\n            "+(a||"email")+" :",n||"",function(e){o(t&&"function"==typeof t?t(e):e)})})},this.isemail=/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.(aero|arpa|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|mobi|[a-z][a-z])|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/,this.isEmail=function(e){return n.isemail.test(e)},this.is_email=this.isEmail,this.isusername=/^[a-z0-9_-]{4,16}$/,this.isUsername=function(e){return n.isusername.test(e)},this.is_username=this.isUsername,this.ispassword=/^[-@.\/\!\$\%\^|#&,+\w\s]{6,50}$/,this.isPassword=function(e){return n.ispassword.test(e)},this.is_password=this.isPassword,this.isnumber=/^-{0,1}\d*\.{0,1}\d+$/,this.isNumber=function(e){return n.isnumber.test(e)},this.is_number=this.isNumber,this.istelephone=/^[\+]?[(]?[0-9]{3}[)]?[-\s\.]?[0-9]{3}[-\s\.]?[0-9]{4,6}$/im,this.isTelephone=function(e){return n.istelephone.test(e)},this.is_telephone=this.isTelephone,this.isdateTime=/^(0[1-9]|[12][0-9]|3[01])-(0[1-9]|1[012])-(19|20)[0-9]{2} (2[0-3]|[0-1][0-9]):[0-5][0-9]$/,this.isDateTime=function(e){return n.isdateTime.test(e)},this.is_date_time=this.isDateTime,this.matches=function(e,a){return e===a},this.num2month=function(e){return!isNaN(e)&&e<=11?i[e]:"Invalid Month"},this.unique=function(e){if(Array.isArray(e)){for(var a=new Array,t=e.length-1;t>=0;t--){for(var o=e.length-1;o>=0;o--)e[t]==e[o]&&t!=o&&delete e[o];void 0!=e[t]&&a.push(e[t])}return a.reverse()}return n.notify("Could not remove duplicates from a non array object","danger"),e},this.removeDuplicates=this.unique,this.remove_duplicates=this.removeDuplicates,this.count=function(e,a){if(Array.isArray(a)){if(Array.isArray(e)){var t=0,o=[];for(var r in e){o[t]=0;for(var i in a)e[r]===a[i]&&(o[t]=isNaN(o[t])?1:o[t]+=1);t++}return o}var o=0;for(var i in a)e===a[i]&&(o+=1);return o}n.notify("The object to perform an array count on is not an Array.","danger")},this.post=function(a,n){return new Promise(function(t,o){e.post(a,n).success(t).error(o)})},this.get=function(a,n){return new Promise(function(t,o){e.get(a,{params:n}).success(t).error(o)})},this.put=function(a,n){return new Promise(function(t,o){e.put(a,n).success(t).error(o)})},this.delete=function(a,n){return new Promise(function(t,o){e.delete(a,{params:n}).success(t).error(o)})},this.db=function(n,t){return new Promise(function(o,r){t=t?t:a.url+"/php",e.get(t,{params:n}).success(o).error(r)})},this.mail=function(n,t){return new Promise(function(o,r){t=t?t:a.url+"/sendMail",e.post(t,n).success(o).error(r)})},this.handler=function(e){e=e.response?e:e.data,200==e.response?n.alert("<font color=green>Done</font>",n.str(e.data.message)):n.alert("<font color=red>Failed</font> ( "+e.response+" Error )",n.str(e.data.message))},this.remote_handler=function(e){n.alert("<font color=blue>Data Response</font>",n.str(n.str(e)))},this.remoteHandler=this.remote_handler}]).service("sms",["app","remoteAuth",function(e,a){var n=this;this.socket;var t=this.socket;this.start=function(n){return t=io.connect(n||a.url),t.on("connect",function(){console.log("Successfully established a connection to the framify SMS gateway")}),t.on("disconnect",function(){console.log("Dropped the framify SMS gateway connection.")}),t.on("reconnect",function(){console.log("Re-established a connection to the SMS gateway.")}),Promise.resolve(e.make_response(200,"Starting the SMS gateway")).catch(function(e){console.log("There was a problem when starting the SMS relay service."),console.dir(e)})},this.stop=function(){return t&&(t.disconnect(),console.log("Terminated all existing SMS gateway connections.")),t=void 0,Promise.resolve(e.make_response(200,"Stoping the SMS gateway")).catch(function(e){console.log("There was a problem when starting the SMS relay service"),console.dir(e)})},this.SMS=function(a){return t?(t.emit("sendSMS",a),Promise.resolve(!0).catch(function(e){console.log("Encountered an error when processing the sms function."),console.dir(e)})):(e.alert("<font  color=red>SMS SERVICE NOT STARTED</font>","Framify failed to execute an SMS related command.<br>Reason: <code>The SMS service provider has not been defined.</code>"),Promise.reject(!1).catch(function(e){console.log("Encountered an error when processing the sms function."),console.dir(e)}))},this.oneSMS=function(a,n,o){if(t){var r;return r=Array.isArray(a)?a:{telephone:a,message:n,password:o},t.emit("sendSMS",r),Promise.resolve(e.make_response(200,"Queued the SMS for sending")).catch(function(e){console.log("Encountered an error when processing the sendsms function."),console.dir(e)})}return e.alert("<font  color=red>SMS SERVICE NOT STARTED</font>","Framify failed to execute an SMS related command.<br>Reason: <code>The SMS service provider has not been defined.</code>"),Promise.reject(!1).catch(function(e){console.log("Encountered an error when processing the sms function."),console.dir(e)})},this.bulkSMS=function(a,o,r){return new Promise(function(i,s){t?!function(){var s=[];r?Array.isArray(a)?(a.forEach(function(a){e.isTelephone(a)?s.push({telephone:a,message:o,apiKey:r}):e.notify("<center>Could not send an SMS message to the invalid number "+a+".</center>","danger")},n),t.emit("sendSMS",s),i(e.make_response(200,"Queued the messages for sending."))):e.notify('<font style="weight:bold;color:white;">Bulk SMS error.</font><br><center>You can only use the bulk SMS service with an array of telephone contacts</center>',"danger"):e.alert("<font style='weight:bold;color:red;'>ERROR</font>","<center>Failed to instantiate the SMS sending service before api Key definition.</center>")}():(e.alert("<font  color=red>SMS SERVICE NOT STARTED</font>","Framify failed to execute an SMS related command.<br>Reason: <code>The SMS service provider has not been defined.</code>"),s(e.make_response(500,"The SMS service is not started.")))})}}]).service("cgi",[function(){this.ajax=function(e){return $.ajax({method:"GET",url:"/php",data:e})},this.mail=function(e){return $.ajax({method:"POST",url:"/sendMail",data:e})}}]).service("auth",["$http","$localStorage",function(e,a){var n=this;n.SetAuth=function(n){return new Promise(function(t,o){t(e.defaults.headers.common.Authorization=n||a.framify_user?a.framify_user.token:void 0)})},n.set_auth=n.SetAuth,n.Register=function(a){return new Promise(function(n,t){e.post("/auth/register",a).success(function(e){200==e.response?n(e.data.message):t(e.data.message)}).error(function(e){t(JSON.stringify((e&&e.data?e.data.message:e)||"Could not obtain a response from the server."))})})},n.register=n.Register,n.Login=function(t){return new Promise(function(o,r){e.post("/auth/verify",t).success(function(e){200==e.response?(a.framify_user=e.data.message,n.SetAuth(e.data.message.token),o(e.data.message)):r(e.data.message)}).error(function(e){r(JSON.stringify((e&&e.data?e.data.message:e)||"Could not obtain a response from the server."))})})},n.login=n.Login,n.Logout=function(){return new Promise(function(e,t){delete a.framify_user,n.SetAuth(void 0).then(e)})},n.logout=n.Logout}]).service("remoteAuth",["$http","$localStorage",function(e,a){var n=this;n.url="http://bixbyte.io",n.setUrl=function(e){return new Promise(function(a,t){n.url=e,console.log("The remote access url has been set to "+e),a(e)})},n.set_url=n.setUrl,n.SetAuth=function(n){return new Promise(function(t,o){t(e.defaults.headers.common.Authorization=n||a.framify_user?a.framify_user.token:void 0)})},n.set_auth=n.SetAuth,n.Register=function(a){return new Promise(function(t,o){e.post(n.url+"/auth/register",a).success(function(e){200==e.response?t(e.data.message):o(e.data.message)}).error(function(e){o(JSON.stringify((e&&e.data?e.data.message:e)||"Could not obtain a response from the server."))})})},n.register=n.Register,n.Login=function(t){return new Promise(function(o,r){e.post(n.url+"/auth/verify",t).success(function(e){200==e.response?(a.framify_user=e.data.message,n.SetAuth(e.data.message.token),o(e.data.message)):r(e.data.message)}).error(function(e){r(JSON.stringify((e&&e.data?e.data.message:e)||"Could not obtain a response from the server."))})})},n.login=n.Login,n.Logout=function(){return new Promise(function(e,t){delete a.framify_user,n.SetAuth(void 0).then(e)})},n.logout=n.Logout}]).run(["app","cgi","$rootScope","$state","$localStorage","sms","auth","remoteAuth","$http",function(e,a,n,t,o,r,i,s,u){n.location=t,n.storage=o,n.app=e,n.cgi=a,n.frame={},n.sms=r,n.auth=i,n.remoteAuth=s,n.frame.path=function(){return t.absUrl().split("/#/")[0]+"/#/"+t.absUrl().split("/#/")[1].split("#")[0]},n.storage.admin={},n.frame.relocate=function(e){console.log("Relocating to: #"+e),n.location.go(e)},n.frame.is_admin=!1,n.frame.isAdmin=function(){return!!n.frame.is_admin},n.frame.isRoot=function(){return 0==n.storage.admin.access},n.frame.changeAdmin=function(e){n.frame.is_admin=e},n.frame.reset=function(){delete n.storage.admin,delete n.storage.user,n.storage.admin={},n.storage.user={},n.frame.changeAdmin(!1),window.location="/#/"},o.framify_user&&(u.defaults.headers.common.Authorization=o.framify_user.token)}]).controller("framifyController",["$scope","$state","$rootScope","$http",function(e,a,n,t){e.current={},e.ui={},n.nav=[],n.nav.search,n.links=[],e.nav.hasFilters=!1,e.openFilters=function(a){a===!0?e.nav.hasFilters=!1:e.nav.hasFilters=!0},n.app.reinit=function(){e.location.path("/framify")},n.exec=function(e){return e()},n.setVar=function(e,a,t){if(1===a.length)e[a[0]]=t;else{var o=a.shift();e[o]=n.setVar("undefined"==typeof e[o]?{}:e[o],a,t)}return e},n.set_var=n.setVar,n.secure=function(a){var t=window.location.href.split("/"),o=t[t.length-1];e.links.indexOf(o)>=0&&n.exec(a)},e.add={},e.fetch={},e.fetched={},e.counted={},e.data={},e.data.login={},e.data.admin={},n.frame.changeAdmin(!1),e.logedin=!1,e.appRedirect=function(e){a.go("app."+e)},e.app_redirect=e.appRedirect,e.goTo=function(e){a.go(e)},e.go_to=e.goTo,e.unwanted=["$$hashKey","$index"],e.removeUnwanted=function(a){return Object.keys(a).forEach(function(n){e.unwanted.indexOf(n)!=-1&&(a[n]=void 0,delete a[n])}),a},e.remove_unwanted=e.removeUnwanted,e.add=function(a,n,t,o){return new Promise(function(r,i){n=n?e.app.json(n):{},n.command="add",n.table=void 0!=a?a.toString().replace(/vw_/gi,""):"",n.token=n.token||e.storage.admin._,n.extras=n&&n.extras?n.extras.replace(/LIMIT 1/gi,""):void 0,t&&t.split(",").forEach(function(a){n[a]&&(n[a]=e.app.md5(n[a]))}),e.app.db(e.removeUnwanted(n)).then(function(t){if(t=e.app.json(t),200==t.response)e.app.notify("<center> "+t.data.message+"</center>","success"),e.fetch(a,{specifics:n.specifics}),e.data[a.toString().replace(/vw_/gi,"")]={},r(o&&"function"==typeof o?o(t,n):!0);else{if(Array.isArray(t.data.message)){var s=t.data.message[2].match(/DETAIL:(.*)/);void 0!=s||null!=s?t.data.message=s[1]:t.data.message=t.data.message[2]}e.app.notify("<center>"+t.data.message+"</center>","danger"),i(e.app.makeResponse(500,s[1]))}})})},e.update=function(a,n,t,o){return new Promise(function(r,i){n=n?e.app.json(n):{},n.command="update",n.table=void 0!=a?a.toString().replace(/vw_/gi,""):"",n.token=n.token||e.storage.admin._,n.extras=n&&n.extras?n.extras.replace(/LIMIT 1/gi,""):void 0,t&&t.split(",").forEach(function(a){n[a]&&(n[a]=e.app.md5(n[a]))}),e.app.db(e.removeUnwanted(n)).then(function(t){if(t=e.app.json(t),200==t.response)e.app.notify("<center> "+t.data.message+"</center>","success"),e.fetch(a,{specifics:n.specifics}),e.data[a.toString().replace(/vw_/gi,"")]={},r("function"==typeof o?o(t):!0);else{if(Array.isArray(t.data.message)){var s=t.data.message[2].match(/DETAIL:(.*)/);void 0!=s||null!=s?t.data.message=s[1]:t.data.message=t.data.message[2]}e.app.notify("<center>"+t.data.message+"</center>","danger"),i(e.app.makeResponse(500,t.data.message))}})})};var o=function(a,n,t){return new Promise(function(o,r){n=n?e.app.json(n):{},n.command="get",n.table=a,console.log("\nprocessing the fetching of table "+a+"\n"),t&&t.split(",").forEach(function(a){n[a]&&(n[a]=e.app.md5(n[a]))}),e.app.db(e.removeUnwanted(n)).then(function(n){if(n=e.app.json(n),200==n.response)e.fetched[a]=n.data.message,e.app.doNothing().then(function(e){o(n)});else{if(Array.isArray(n.data.message)){var t=n.data.message[2].match(/DETAIL:(.*)/);void 0!=t||null!=t?n.data.message=t[1]:n.data.message=n.data.message[2]}e.app.notify("<center>"+n.data.message+"</center>","danger"),r(e.app.makeResponse(500,n.data.message))}})})};e.fetch=function(e,a,n,t){if(!Array.isArray(e))return Promise.resolve(o(e,a,n)).catch(function(e){console.log("Encountered an error when processing the fetch function."),console.dir(e)});var r=function(){var a=new Array;return e.filter(function(e){return"undefined"!=typeof e[0]}).forEach(function(e,t){a.push(o(e[0],e[1]||{}),n)}),a=a.filter(function(e){return"undefined"!=typeof e}),{v:Promise.all(a)}}();return"object"===("undefined"==typeof r?"undefined":_typeof(r))?r.v:void 0},e.del=function(a,n,t,o){return new Promise(function(o,r){n=n?e.app.json(n):{},n.command="del",n.table=void 0!=a?a.toString().replace(/vw_/gi,""):"",n.token=n.token||e.storage.admin._,t&&t.split(",").forEach(function(a){n[a]&&(n[a]=e.app.md5(n[a]))}),e.app.db(e.removeUnwanted(n)).then(function(n){if(n=e.app.json(n),200==n.response)e.app.notify("<center>"+n.data.message+"</center>","success"),e.fetch(a),r(n);else{if(Array.isArray(n.data.message)){var t=n.data.message[2].match(/DETAIL:(.*)/);void 0!=t||null!=t?n.data.message=t[1]:n.data.message=n.data.message[2]}e.app.notify("<center>"+n.data.message+"</center>","danger"),o(e.app.makeResponse(500,n.data.message))}})})},e.login=function(a){return new Promise(function(n,t){a&&(e.data.login[a]=e.app.md5(e.data.login[a])),e.data.login.command="get",e.data.login.table="users",e.data.login.extras=" AND active is true LIMIT 1",e.app.db(e.removeUnwanted(e.data.login)).then(function(a){if(e.data.admin.extras="",a=e.app.json(a),200==a.response)a.data.message.length>0&&"object"==_typeof(a.data.message[0])?(a.data.message[0].username==e.data.login.username?(e.storage.user=a.data.message[0],e.logedin=!0):(delete e.storage.user,window.location="/#/"),n()):(delete e.storage.user,e.app.notify("<center>You have entered the wrong login credentials.</center>","danger"));else{if(Array.isArray(a.data.message)){var o=a.data.message[2].match(/DETAIL:(.*)/);void 0!=o||null!=o?a.data.message=o[1]:a.data.message=a.data.message[2]}delete e.storage.user,e.app.notify("<center>"+a.data.message+"</center>","danger"),t(e.app.makeResponse(500,a.data.message))}})})},e.adminLogin=function(a){return new Promise(function(t,o){a&&(e.data.admin[a]=e.app.md5(e.data.admin[a])),e.data.admin.command="get",e.data.admin.table="admins",e.data.admin.extras=" AND active is true LIMIT 1",e.app.db(e.removeUnwanted(e.data.admin)).then(function(a){if(e.data.admin.extras="",a=e.app.json(a),200==a.response)a.data.message.length>0&&void 0!=_typeof(a.data.message[0])?a.data.message[0].password===e.data.admin.password?(e.storage.admin=a.data.message[0],e.storage.admin._={},e.storage.admin._.user=a.data.message[0].admin_name,e.storage.admin._.key=a.data.message[0].password,n.frame.changeAdmin(!0),t(a)):(delete e.data.admin,delete e.storage.admin,e.storage.admin={},window.location="/#/admin",t(a)):(delete e.data.admin,delete e.storage.admin,e.storage.admin={},e.app.notify("<center>You have entered the wrong login credentials.</center>","danger"),window.location="/#/admin",o(!1));else{if(Array.isArray(a.data.message)){var r=a.data.message[2].match(/DETAIL:(.*)/);void 0!=r||null!=r?a.data.message=r[1]:a.data.message=a.data.message[2]}delete e.storage.admin,e.storage.admin={},e.app.notify("<center>"+a.data.message+"</center>","danger"),o(e.app.makeResponse(500,a.data.message))}})})},e.islogedin=function(){return new Promise(function(a,n){e.storage.user?(e.data.login.username=e.storage.user.username,e.data.login.password=e.storage.user.password,e.login(),a(!0)):(e.app.notify("<center>You have no permission to access this content</center>","danger"),n(!1))})},e.logout=function(){return e.islogedin=!1,delete e.storage.user,window.location="/#/",Promise.resolve(!0).catch(function(e){console.log("Encountered an error when processing the logout function."),console.dir(e)})},e.redirect=function(e){return e?window.location=e:window.location="/#/framify",Promise.resolve(!0).catch(function(e){console.log("Encountered an error when processing the redirect function."),console.dir(e)})},e.authorize=function(){return e.storage.admin&&e.data.admin.admin_name&&e.data.admin.password?(e.data.admin={},e.data.admin.admin_name=e.storage.admin.admin_name,e.data.admin.password=e.storage.admin.password,e.adminLogin()):e.location="/#/admin",Promise.resolve(!0).catch(function(e){console.log("Encountered an error when processing the authorize function."),console.dir(e)})},e.deauthorize=function(){return delete e.storage.admin,n.frame.changeAdmin(!1),window.location="/#/",Promise.resolve(!0).catch(function(e){console.log("Encountered an error when processing the deauthorize function."),console.dir(e)})},e.custom=function(a,n,t,o){return new Promise(function(o,r){n=n?e.app.json(n):{},n.command="custom",n.token=n.token||e.storage.admin._,t&&t.split(",").forEach(function(a){n[a]&&(n[a]=e.app.md5(n[a]))}),e.app.db(e.removeUnwanted(n)).then(function(n){if(n=e.app.json(n),200==n.response)e.app.notify("<center>"+(n.data.message||"Successful")+"</center>","success"),e.cFetched[a]=n.data.message,e.data[a.toString().replace(/vw_/gi,"")]={},o(n);else{if(Array.isArray(n.data.message)){var t=n.data.message[2].match(/DETAIL:(.*)/);void 0!=t||null!=t?n.data.message=t[1]:n.data.message=n.data.message[2]}e.app.notify("<center>"+n.data.message+"</center>"),r(e.app.makeResponse(500,n.data.message))}})})},e.count=function(a,n,t,o){return new Promise(function(o,r){n=n?e.app.json(n):{},n.table=a,
n.command="count",n.token=n.token||{},t&&t.split(",").forEach(function(a){n[a]&&(n[a]=e.app.md5(n[a]))}),e.app.db(e.removeUnwanted(n)).then(function(n){if(n=e.app.json(n),200==n.response)e.counted[a.toString().replace(/vw_/gi,"")]=n.data.message,e.data[a.toString().replace(/vw_/gi,"")]={},o(n);else{if(Array.isArray(n.data.message)){var t=n.data.message[2].match(/DETAIL:(.*)/);void 0!=t||null!=t?n.data.message=t[1]:n.data.message=n.data.message[2]}e.app.notify("<center>"+n.data.message+"</center>","danger"),r(e.app.makeResponse(500,n.data.message))}})})},e.sort=function(a){e.sortKey=a,e.reverse=!e.reverse},e.sanitize=function(e,a){if(a)return a.split(",").forEach(function(a){delete e[a]}),Promise.resolve(e).catch(function(e){console.log("Encountered an error when processing the sanitize function."),console.dir(e)})},e.dPush=function(e,a,n){return e[a]=n,e},e.d_push=e.dPush,e.dPushify=function(a,n,t){return Promise.resolve(e.dPush(a,n,t))},e.d_pushify=e.dPushify,e.currmoin=e.app.monthNum(),e.setMoin=function(a){e.currmoin=a},e.set_moin=e.setMoin,e.delParams=function(e,a){return e=e||{},a=a?a.split(","):[],a.forEach(function(a){e[a]=null,delete e[a]}),e},e.del_params=e.delParams,e.addExtras=function(e,a,n,t){return new Promise(function(o,r){e=e||{},a=a||{},n=n||"",t=t||"";var i="",s=[],u=[];t=t.split(",").filter(function(e){return e}),t.forEach(function(e){a[e]=null,delete a[e]}),n.split(",").forEach(function(e,a){var n=e.split(":");s[a]=n[0],u[a]=n[1]});var l=Object.keys(a);s.forEach(function(e,n){l.indexOf(e)!=-1&&(a[u[n]]=a[e],a[e]=null,delete a[e])}),s=Object.keys(a),u=null,s.forEach(function(e,n){var t=isNaN(a[e])?"'"+a[e]+"'":parseInt(a[e]);i+=" "+e+"="+t+" AND"}),s=null,e.extras=i.replace(/AND+$/,""),o(e)})},e.add_extras=function(e,a,n,t){return new Promise(function(o,r){e=e||{},a=a||{},n=n||["",""],t=t||["",""];var i="",s=[],u=[],l=[],c=[];if(Array.isArray(n)&&Array.isArray(t)){var m=t[0].split(",").filter(function(e){return e}),d=t[1].split(",").filter(function(e){return e});m.forEach(function(a){e[a]=null,delete e[a]}),d.forEach(function(e){a[e]=null,delete a[e]});var f=n[0].split(","),h=n[1].split(",");f.forEach(function(e,a){var n=e.split(":");s[a]=n[0],l[a]=n[1]}),h.forEach(function(e,a){var n=e.split(":");u[a]=n[0],c[a]=n[1]});var g=Object.keys(a),p=Object.keys(e);s.forEach(function(a,n){p.indexOf(a)!=-1&&(e[l[n]]=e[a],e[a]=null,delete e[a])}),u.forEach(function(e,n){g.indexOf(e)!=-1&&(a[c[n]]=a[e],a[e]=null,delete a[e])}),u=null,u=Object.keys(a),c=null,u.forEach(function(e,n){var t=isNaN(a[e])?"'"+a[e]+"'":parseInt(a[e]);i+=" "+e+"="+t+" AND"}),u=null,e.extras=i.replace(/AND+$/,""),o(e)}else r("This Method only allows substitution and removal Arrays, <br> please consider using the <b><i>addExtras</i></b> object instead.")})},e.service={},e.entity={},e.showService=function(a){e.service.available=!0,e.service.current=a},e.showEntity=function(a){e.entity.available=!0,e.entity.current=a},e.howMany=function(a,n){var n=n||{owner:e.storage.user.username};n=n?e.app.json(n):{},n.table=a||"entities",n.command="count",n.token={},e.app.db(e.removeUnwanted(n)).then(function(a){if(a=e.app.json(a),200==a.response)a.data.message&&e.app.notify(a.data.message,"success"),e.counted[n.table.toString().replace(/vw_/gi,"")]=a.data.message;else{if(Array.isArray(a.data.message)){var t=a.data.message[2].match(/DETAIL:(.*)/);void 0!=t||null!=t?a.data.message=t[1]:a.data.message=a.data.message[2]}else a.data.message;alert("<center>"+a.data.message+"</center>")}})},e.data.login=e.data.login||{},e.data.me=e.data.me||{},e.setData,e.handlers={},e.r_handlers=e.handlers,e.handlers.regSuccess=function(n){e.app.notify("You have been successfully registered"),a.go("app.login")},e.r_handlers.regSuccess=e.handlers.regSuccess,e.handlers.reg_success=e.handlers.regSuccess,e.r_handlers.reg_success=e.handlers.regSuccess,e.handlers.loginSuccess=function(n){e.app.notify("<i class='fa fa-2x fa-spin fa-circle-o-notch'></i> Processing your login data","success",4e3),a.go("app.panel")},e.r_handlers.loginSuccess=e.handlers.loginSuccess,e.handlers.login_success=e.handlers.loginSuccess,e.r_handlers.login_success=e.handlers.loginSuccess,e.handlers.regError=function(a){e.app.alert("<font color='red'>Signup Error</font>",a)},e.r_handlers.regError=e.handlers.regError,e.handlers.reg_error=e.handlers.regError,e.r_handlers.reg_rror=e.handlers.regError,e.handlers.loginError=function(a){e.app.alert("<font color='red'>Login Error</font>",a)},e.r_handlers.loginError=e.handlers.loginError,e.handlers.login_error=e.handlers.loginError,e.r_handlers.login_error=e.handlers.loginError,e.handlers.identity=function(){return new Promise(function(n,o){t.get("/auth/me").success(function(a){o(e.data.me=a.data.message)}).error(function(t){e.auth.Logout().then(function(){e.app.notify("<i class='fa  fa-exclamation-triangle'></i>&nbsp;&nbsp;Your lease has expired <br>Please Login to continue.","danger"),n(a.go("app.login"))})})})},e.r_handlers.identity=function(){return new Promise(function(n,o){console.log("Querying the remote server for identity"),t.get(e.remoteAuth.url+"/auth/me").success(function(a){console.log("Remote Knows who you are."),o(e.data.me=a.data.message)}).error(function(t){console.log("Something just didn't go well."),e.auth.Logout().then(function(){e.app.notify("<i class='fa  fa-exclamation-triangle'></i>&nbsp;&nbsp;Your lease has expired <br>Please Login to continue.","danger"),n(a.go("app.login"))})})})},e.handlers.isLogedIn=function(){return new Promise(function(n,o){e.storage.framify_user?t.defaults.headers.common.Authorization&&void 0!=t.defaults.headers.common.Authorization&&""!=t.defaults.headers.common.Authorization?(console.log("\nAll Looks good! Let me see if I can get you into the party\n"),"app.login"==a.current.name?n(a.go("app.panel")):n()):(console.log("\nThe authentication header is not yet defined\n"),e.auth.SetAuth(void 0).then(function(){console.log("\nThe authentication header has been set to "+t.defaults.headers.common.Authorization+"\n"),"app.login"==a.current.name?n(a.go("app.panel")):n()})):(console.log("\nNo localstorage value is defined\n"),"app.login"!=a.current.name&&(console.log("\nRedirecting to the authentication page.\n"),e.app.notify("<i class='fa  fa-exclamation-triangle'></i>&nbsp;&nbsp;Please Login to continue.","danger"),o(a.go("app.login"))))})},e.handlers.is_loged_in=e.handlers.isLogedIn,e.r_handlers.isLogedIn=function(){return new Promise(function(n,o){console.log("Handing you over to the remote authentication server."),e.storage.framify_user?t.defaults.headers.common.Authorization&&void 0!=t.defaults.headers.common.Authorization&&""!=t.defaults.headers.common.Authorization?"app.login"==a.current.name?n(a.go("app.panel")):n():e.remoteAuth.SetAuth(void 0).then(function(){"app.login"==a.current.name?n(a.go("app.panel")):n()}):"app.login"!=a.current.name&&(e.app.notify("<i class='fa  fa-exclamation-triangle'></i>&nbsp;&nbsp;Please Login to continue.","danger"),o(a.go("app.login")))})},e.r_handlers.is_loged_in=e.r_handlers.isLogedIn}]).directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,a,n,t){function o(){t.$setViewValue(a.html())}t.$render=function(){a.html(t.$viewValue||"")},a.bind("blur keyup change",function(){e.$apply(o)})}}}).directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(a,n,t){var o=e(t.fileModel),r=o.assign;n.bind("change",function(){a.$apply(function(){r(a,n[0].files[0])})})}}}]).config(["ChartJsProvider",function(e){e.setOptions({colors:["#4AB151","#387EF5","#FF0000","#DCDCDC","#46BFBD","#FDB45C","#949FB1","#4D5360"]})}]);
//# sourceMappingURL=maps/framify.min.js.map
